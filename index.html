<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Salesforce API Test – Request & Response Details</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2em auto; }
    label { display: block; margin-top: 1em; }
    input, textarea { width: 100%; padding: 0.5em; box-sizing: border-box; font-family: monospace; }
    button { margin-top: 1.5em; padding: 0.7em 1.2em; }
    details { margin-top: 1em; border: 1px solid #ccc; border-radius: 4px; background: #f9f9f9; }
    summary { padding: 0.5em; font-weight: bold; cursor: pointer; }
    pre { padding: 0.5em; white-space: pre-wrap; font-family: monospace; margin: 0; }
  </style>
</head>
<body>
  <h2>Salesforce API Test – Request & Response Details</h2>
  
  <label for="apiUrl">
    API URL:
    <input id="apiUrl" type="text"
      value="https://altium--test.sandbox.my.salesforce-sites.com/PublicApi/services/apexrest/g2cemailcheck">
  </label>
  
  <label for="accessToken">
    Access Token:
    <input id="accessToken" type="text" value="my-secret-token-123">
  </label>

  <label for="primaryEmail">
    Primary Email:
    <input id="primaryEmail" type="email" placeholder="test@example.com" required>
  </label>
  
  <label for="studentEmail">
    Student Email:
    <input id="studentEmail" type="email" placeholder="student@university.edu" required>
  </label>
  
  <button onclick="testApi()">Send Request</button>
  
  <details id="reqDetails">
    <summary>Request Details</summary>
    <pre id="requestDetails">— not sent —</pre>
  </details>
  
  <details id="resDetails">
    <summary>Response Details</summary>
    <pre id="responseDetails">— no data —</pre>
  </details>

  <script>
    async function testApi() {
      // Clear previous data
      document.getElementById('requestDetails').textContent = '— not sent —';
      document.getElementById('responseDetails').textContent = '— no data —';

      const url = document.getElementById('apiUrl').value.trim();
      const token = document.getElementById('accessToken').value.trim();
      const primaryEmail = document.getElementById('primaryEmail').value.trim();
      const studentEmail = document.getElementById('studentEmail').value.trim();

      if (!url || !token) {
        alert('Please provide both API URL and access token.');
        return;
      }
      if (!primaryEmail || !studentEmail) {
        alert('Please fill in both email fields.');
        return;
      }

      const method = 'POST';
      const headers = {
        'Content-Type': 'application/json',
        'X-Access-Token': token
      };
      const body = JSON.stringify({ primaryEmail, studentEmail }, null, 2);

      // Show request details
      document.getElementById('requestDetails').textContent =
        `URL: ${url}\n` +
        `Method: ${method}\n` +
        `Headers: ${JSON.stringify(headers, null, 2)}\n` +
        `Body:\n${body}`;

      try {
        const response = await fetch(url, { method, headers, body });
        const statusLine = `${response.status} ${response.statusText}`;
        let responseHeaders = {};
        response.headers.forEach((val, key) => { responseHeaders[key] = val; });

        // Read response body
        let responseBody;
        const contentType = response.headers.get('Content-Type') || '';
        if (contentType.includes('application/json')) {
          const json = await response.json();
          responseBody = JSON.stringify(json, null, 2);
        } else {
          responseBody = await response.text();
        }

        // Show response details
        document.getElementById('responseDetails').textContent =
          `Status: ${statusLine}\n` +
          `Headers: ${JSON.stringify(responseHeaders, null, 2)}\n` +
          `Body:\n${responseBody}`;
      } catch (err) {
        document.getElementById('responseDetails').textContent =
          `Fetch error:\n${err}`;
      }
    }
  </script>
</body>
</html>
