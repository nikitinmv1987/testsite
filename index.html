<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Salesforce API Test – Custom Header</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 2em auto; }
    label { display: block; margin-top: 1em; font-weight: bold; }
    textarea, input { width: 100%; padding: 0.5em; box-sizing: border-box; font-family: monospace; }
    textarea { resize: vertical; }
    button { margin-top: 1.5em; padding: 0.7em 1.2em; }
    details { margin-top: 1em; border: 1px solid #ccc; border-radius: 4px; background: #f9f9f9; }
    summary { padding: 0.5em; font-weight: bold; cursor: pointer; }
    pre { padding: 0.5em; white-space: pre-wrap; font-family: monospace; margin: 0; }
  </style>
</head>
<body>
  <h2>Salesforce API Test – Custom “x-access-token” Header</h2>
  
  <label for="apiUrl">API URL:</label>
  <textarea id="apiUrl" rows="2">https://altium--test.sandbox.my.salesforce-sites.com/PublicApi/services/apexrest/g2cemailcheck</textarea>
  
  <label for="accessToken">x-access-token:</label>
  <textarea id="accessToken" rows="1">my-secret-token-123</textarea>

  <label for="primaryEmail">Primary Email:</label>
  <input id="primaryEmail" type="email" placeholder="test@example.com" required>
  
  <label for="studentEmail">Student Email:</label>
  <input id="studentEmail" type="email" placeholder="student@university.edu" required>
  
  <button onclick="testApi()">Send Request</button>
  
  <details id="reqDetails">
    <summary>Request Details</summary>
    <pre id="requestDetails">— not sent —</pre>
  </details>
  
  <details id="resDetails">
    <summary>Response Details</summary>
    <pre id="responseDetails">— no data —</pre>
  </details>

  <script>
    async function testApi() {
      // clear previous
      document.getElementById('requestDetails').textContent = '— not sent —';
      document.getElementById('responseDetails').textContent = '— no data —';

      const url    = document.getElementById('apiUrl').value.trim();
      const token  = document.getElementById('accessToken').value.trim();
      const email1 = document.getElementById('primaryEmail').value.trim();
      const email2 = document.getElementById('studentEmail').value.trim();

      if (!url || !token) {
        alert('Please provide both API URL and x-access-token.');
        return;
      }
      if (!email1 || !email2) {
        alert('Please fill in both email fields.');
        return;
      }

      const payload = { primaryEmail: email1, studentEmail: email2 };
      const body    = JSON.stringify(payload, null, 2);

      // build headers via the Headers API
      const headers = new Headers();
      headers.append('Content-Type', 'application/json');
      headers.append('x-access-token', token);
      // also lowercase variant, in case Apex maps keys to lowercase
      headers.append('x-access-token', token);

      // log to console so you can inspect in DevTools → Network
      console.log('Request Headers:');
      headers.forEach((v,k) => console.log(k + ':', v));

      // prepare a Request object if you want detailed inspection
      const requestObj = new Request(url, { method: 'POST', headers, body });
      console.log('Request Object:', requestObj);

      // show request details on page
      document.getElementById('requestDetails').textContent =
        `URL: ${url}\n` +
        `Method: POST\n` +
        `Headers: ${JSON.stringify(
          Array.from(headers.entries())
            .reduce((o,[k,v]) => (o[k]=v,o),{}), null, 2)}\n` +
        `Body:\n${body}`;

      try {
        const resp = await fetch(requestObj);
        const statusLine = `${resp.status} ${resp.statusText}`;
        let respHeaders = {};
        resp.headers.forEach((v,k) => { respHeaders[k]=v; });

        // parse response body
        let respBody;
        const ct = resp.headers.get('Content-Type') || '';
        if (ct.includes('application/json')) {
          respBody = JSON.stringify(await resp.json(), null, 2);
        } else {
          respBody = await resp.text();
        }

        // show on page
        document.getElementById('responseDetails').textContent =
          `Status: ${statusLine}\n` +
          `Headers: ${JSON.stringify(respHeaders, null, 2)}\n` +
          `Body:\n${respBody}`;

      } catch (err) {
        console.error('Fetch error:', err);
        document.getElementById('responseDetails').textContent =
          `Fetch error:\n${err}`;
      }
    }
  </script>
</body>
</html>
