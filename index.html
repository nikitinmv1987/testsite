<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Salesforce API Test with Detailed Logging</title>
  <style>
    body { font-family: sans-serif; max-width: 700px; margin: 2em auto; }
    label { display: block; margin-top: 1em; }
    input { width: 100%; padding: 0.5em; box-sizing: border-box; }
    button { margin-top: 1.5em; padding: 0.7em 1.2em; }
    #output, #log {
      background: #f4f4f4;
      padding: 1em;
      margin-top: 1em;
      white-space: pre-wrap;
      font-family: monospace;
      max-height: 300px;
      overflow-y: auto;
    }
    #log { border: 1px solid #ccc; }
  </style>
</head>
<body>
  <h2>Salesforce API Test with Detailed Logging</h2>
  
  <label for="primaryEmail">
    Primary Email:
    <input id="primaryEmail" type="email" placeholder="test@example.com" required>
  </label>
  
  <label for="studentEmail">
    Student Email:
    <input id="studentEmail" type="email" placeholder="student@university.edu" required>
  </label>
  
  <button onclick="testApi()">Send Request</button>
  
  <h3>Response Output</h3>
  <pre id="output"></pre>
  
  <h3>Log</h3>
  <div id="log"></div>

  <script>
    function appendLog(msg) {
      const logEl = document.getElementById('log');
      const time = new Date().toISOString();
      logEl.textContent += `[${time}] ${msg}\n`;
      logEl.scrollTop = logEl.scrollHeight;
    }

    async function testApi() {
      document.getElementById('output').textContent = '';
      document.getElementById('log').textContent = '';

      const primaryEmail = document.getElementById('primaryEmail').value.trim();
      const studentEmail = document.getElementById('studentEmail').value.trim();

      if (!primaryEmail || !studentEmail) {
        appendLog('ERROR: Both email fields are required.');
        return;
      }

      const url = 'https://altium--test.sandbox.my.salesforce-sites.com/PublicApi/services/apexrest/g2cemailcheck';
      const payload = { primaryEmail, studentEmail };
      const headers = {
        'Content-Type': 'application/json',
        'X-Access-Token': 'my-secret-token-123'
      };

      appendLog('Preparing request');
      appendLog(`URL: ${url}`);
      appendLog(`Method: POST`);
      appendLog(`Headers: ${JSON.stringify(headers)}`);
      appendLog(`Payload: ${JSON.stringify(payload)}`);

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers,
          body: JSON.stringify(payload)
        });

        appendLog(`Received response: ${response.status} ${response.statusText}`);
        appendLog('Response Headers:');
        response.headers.forEach((value, name) => {
          appendLog(`  ${name}: ${value}`);
        });

        let data;
        const contentType = response.headers.get('Content-Type') || '';
        if (contentType.includes('application/json')) {
          data = await response.json();
          appendLog('Parsed JSON body:');
          appendLog(JSON.stringify(data, null, 2));
        } else {
          data = await response.text();
          appendLog('Raw text body:');
          appendLog(data);
        }

        document.getElementById('output').textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        appendLog(`Fetch error: ${err}`);
        document.getElementById('output').textContent = 'Error: ' + err;
      }
    }
  </script>
</body>
</html>
